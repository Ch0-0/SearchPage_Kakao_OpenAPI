<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>search</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
</head>
<body>
    <div class="container">
        <h2>블로그 검색</h2>
        <table class="board_detail">
            <tr>
                <td>인기검색어</td>
            </tr>
            <tr>
                <td>
                    <input id="blogsearch" value="미국" type="text" size="40" class="input" >
                    <input type="button" id="search" value="검색" class="btn">
                    <input type="radio" name="sort" value="accuracy" checked> 정확도순
   					<input type="radio" name="sort" value="recency"> 최신순
                </td>
            </tr>
            <tr>
                <td>
                    <p></p>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="pagination"></div>
                </td>
            </tr>
            
        </table>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript">
    $(function() {
        function performSearch(pageNumber) {
            var $p = $("p");
            $p.empty();
            var sortValue = $('input[name="sort"]:checked').val();
            $.ajax({
                method: 'GET',
                url: 'https://dapi.kakao.com/v2/search/blog?', //url will be modified later
                data: { query: $("#blogsearch").val(), sort: sortValue, page: pageNumber },
                headers: { Authorization: "KakaoAK e81a5d0a03b6e4d20e128b3f8960dbd9" }, //Specific values ​​for access permission will be modified later
                success: function(data) {
                    var documents = data.documents; //first header later modified
                    var pageableCount = data.meta.pageable_count;
                    var currentPage = data.meta.is_end ? Math.ceil(pageableCount / 10) : data.meta.pageable_count / 10 + 1;


                    for (var i = 0; i < documents.length; i++) {
                        var keys = Object.keys(documents[i]);
                        for (var j = 0; j < keys.length; j++) {
                            var key = keys[j];
                            if (key === "thumbnail") { //Picture url later modified
                                $("p").append("<img src='" + documents[i][key] + "'/> <br>");
                            } else {
                                $("p").append("<strong>" + key + ":</strong> " + documents[i][key] + "<br>");
                            }
                        }
                        $("p").append("<br>");
                    }
                        
                        var totalPages = Math.ceil(pageableCount / 10);
                        var paginationHtml = '';
                        for (var i = 1; i <= totalPages; i++) {
                            paginationHtml += '<button class="page-button">' + i + '</button>';
                        }
                        $('#pagination').html(paginationHtml);
                        
                        // highlight current page button
                        $('.page-button').eq(currentPage - 1).addClass('current-page');
                       
              
                        
                    },
                    error: function(err) {
                        console.log("API call failed");
                    }
                });
            }
                
                $("#search").click(function() {
                    performSearch(1);
                    var blogsearchValue = $("#blogsearch").val();
                    $.ajax({
                      url: "Rank",
                      method: "POST",
                      data: { blogsearch: blogsearchValue },
                      success: function(response) {
                        console.log("Success: " + response);
                      },
                      error: function(xhr, status, error) {
                        console.log("Error: " + error);
                      }
                    });
                });

                $('#pagination').on('click', '.page-button', function() {
                    var pageNumber = $(this).text();
                    console.log("Selected number: " + pageNumber);
                    performSearch(pageNumber);
                });
            });
    
        
        
 
    </script>
</body>
</html>